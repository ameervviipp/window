<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<title>حاسبة الخزائن والحلق السفلي</title>
<style>
body{font-family:sans-serif;background:#f3f4f6;margin:0;padding:20px}
.container{max-width:1200px;margin:0 auto;background:#fff;padding:20px;border-radius:10px;box-shadow:0 0 10px rgba(0,0,0,0.1)}
.card{background:#fbfdff;padding:15px;margin-bottom:15px;border-radius:8px;border:1px solid #e6eefc}
.btn{padding:8px 12px;margin-top:8px;border:none;border-radius:6px;background:#0b5ed7;color:#fff;cursor:pointer}
.remove-small{background:#ef4444;color:#fff;border:0;padding:4px 6px;border-radius:6px;cursor:pointer}
.results{margin-top:20px}
.result-item{background:#f8fafc;border:1px solid #e6eefc;padding:12px;border-radius:8px;margin-bottom:12px}
</style>
</head>
<body>
<div class="container">
<h1>حاسبة الخزائن والحلق السفلي</h1>

<div class="card" id="cabinetsPanel">
<h3>الخزائن</h3>
<div id="cabinetsContainer"></div>
<button class="btn" id="addCabinetBtn">➕ إضافة خزانة</button>
</div>

<div class="card" id="basesPanel">
<h3>الحلقات السفلي</h3>
<div id="basesContainer"></div>
<button class="btn" id="addBaseBtn">➕ إضافة حلق</button>
</div>

<button class="btn" id="calculateBtn">حساب النتائج</button>

<div class="results" id="results"></div>
</div>

<script>
const PROFILE_WIDTH=5, CUTTER_WIDTH=5;
let cabinetCount=0, baseCount=0;

document.getElementById('addCabinetBtn').addEventListener('click',()=>{
  cabinetCount++;
  const wrapper=document.createElement('div');
  wrapper.className='card';
  wrapper.id='cabinet'+cabinetCount;
  wrapper.innerHTML=`
    <strong>خزانة ${cabinetCount}</strong>
    <button class="remove-small" onclick="this.parentElement.remove()">×</button>
    <label>عرض:</label><input type="number" class="cabWidth">
    <label>ارتفاع:</label><input type="number" class="cabHeight">
    <label>عمق:</label><input type="number" class="cabDepth">
    <label>أبواب:</label><select class="cabDoors"><option value="1">1</option><option value="2">2</option></select>`;
  document.getElementById('cabinetsContainer').appendChild(wrapper);
});

document.getElementById('addBaseBtn').addEventListener('click',()=>{
  baseCount++;
  const wrapper=document.createElement('div');
  wrapper.className='card';
  wrapper.id='base'+baseCount;
  wrapper.innerHTML=`
    <strong>الحلق ${baseCount}</strong>
    <button class="remove-small" onclick="this.parentElement.remove()">×</button>
    <label>عرض:</label><input type="number" class="baseWidth">
    <label>ارتفاع:</label><input type="number" class="baseHeight">
    <div class="dividersContainer"></div>
    <button class="btn" onclick="addDivider(${baseCount})">➕ إضافة قاطع</button>
    <label>أبواب بعد آخر قاطع:</label>
    <select class="baseDoors"><option value="1">1</option><option value="2">2</option></select>`;
  document.getElementById('basesContainer').appendChild(wrapper);
});

function addDivider(baseId){
  const baseDiv=document.getElementById('base'+baseId);
  const container=baseDiv.querySelector('.dividersContainer');
  const idx=container.children.length+1;
  const row=document.createElement('div');
  row.innerHTML=`<input type="number" class="dividerInput" placeholder="مسافة القاطع ${idx}">
  <select class="dividerDoors"><option value="1">1</option><option value="2">2</option></select>
  <button class="remove-small" onclick="this.parentElement.remove()">×</button>`;
  container.appendChild(row);
}

document.getElementById('calculateBtn').addEventListener('click',()=>{
  const results=document.getElementById('results');
  results.innerHTML='';

  // خزائن
  document.querySelectorAll('[id^="cabinet"]').forEach((cabEl,idx)=>{
    const w=parseFloat(cabEl.querySelector('.cabWidth')?.value)||0;
    const h=parseFloat(cabEl.querySelector('.cabHeight')?.value)||0;
    const d=parseFloat(cabEl.querySelector('.cabDepth')?.value)||0;
    if(w<=0||h<=0||d<=0) return;
    const doors=parseInt(cabEl.querySelector('.cabDoors')?.value)||1;
    const wAdj=w-5, hAdj=h-5, dAdj=d-5;

    let doorHTML='';
    if(doors===1){
      doorHTML=`باب 1 — ${wAdj-3} × ${hAdj-3} — فصالات 2 / يد 1`;
    } else {
      doorHTML=`بابان — لكل باب ${(wAdj-2.5)/2} × ${hAdj-3} — فصالات 2 / يد 1`;
    }
    const div=document.createElement('div');
    div.className='result-item';
    div.innerHTML=`<strong>خزانة ${idx+1}</strong>
      <div>أبعاد بعد خصم 5 سم: ${wAdj} × ${hAdj} × ${dAdj}</div>
      <div>${doorHTML}</div>`;
    results.appendChild(div);
  });

  // حلقات
  document.querySelectorAll('[id^="base"]').forEach((baseEl,idx)=>{
    const w=parseFloat(baseEl.querySelector('.baseWidth')?.value)||0;
    const h=parseFloat(baseEl.querySelector('.baseHeight')?.value)||0;
    if(w<=0||h<=0) return;
    const finalDoors=parseInt(baseEl.querySelector('.baseDoors')?.value)||1;
    const divRows=Array.from(baseEl.querySelectorAll('.dividersContainer .divider-row'));
    const N=divRows.length;
    const inner=w-2*PROFILE_WIDTH-N*CUTTER_WIDTH;
    const distances=divRows.map(r=>parseFloat(r.querySelector('.dividerInput')?.value)||0);
    const sumD=distances.reduce((a,b)=>a+b,0);

    const div=document.createElement('div');
    div.className='result-item';
    div.innerHTML=`<strong>الحلق ${idx+1}</strong><div>الأبعاد: ${w} × ${h}</div>`;
    if(sumD>inner){
      div.innerHTML+=`<div style="color:red">خطأ: مجموع القواطع أكبر من المساحة الداخلية.</div>`;
      results.appendChild(div);
      return;
    }

    const remaining=inner-sumD;
    const segments=[...distances,remaining];
    const doorsPerSegment=segments.map((_,i)=>(i<divRows.length?parseInt(divRows[i].querySelector('.dividerDoors')?.value)||1:finalDoors));
    let totalDoors=0;
    segments.forEach((segWidth,segIdx)=>{
      const doorsCount=doorsPerSegment[segIdx];
      const doorHeight=h-3;
      let doorWidth=doorsCount===1?segWidth-3:(segWidth-2.5)/2;
      div.innerHTML+=`<div>المقطع ${segIdx+1}: باب${doorsCount===1?'':'ان'} — عرض ${doorWidth.toFixed(2)} × ارتفاع ${doorHeight} — فصالات 2 / يد 1</div>`;
      totalDoors+=doorsCount;
    });
    div.innerHTML+=`<div>مجموع الأبواب: ${totalDoors}</div>`;
    results.appendChild(div);
  });
});
</script>
</body>
</html>
